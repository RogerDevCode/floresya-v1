# Database Schema Modification: Replace NULL Values with Default Values

This script modifies the database schema to replace all nullable columns with appropriate default values according to the following rules:

- String/character columns: Default to empty string `''`
- Integer columns: Default to `0`
- Numeric/decimal columns: Default to `0.00`
- Boolean columns: Default to `false`
- Timestamp/date columns: Default to appropriate timestamp

## SQL Script

```sql
-- Modify users table
ALTER TABLE users ALTER COLUMN password_hash SET DEFAULT '';
ALTER TABLE users ALTER COLUMN phone SET DEFAULT '';

-- Modify orders table
ALTER TABLE orders ALTER COLUMN user_id SET DEFAULT 0;
ALTER TABLE orders ALTER COLUMN customer_phone SET DEFAULT '';
ALTER TABLE orders ALTER COLUMN delivery_zip SET DEFAULT '';
ALTER TABLE orders ALTER COLUMN delivery_date SET DEFAULT CURRENT_DATE;
ALTER TABLE orders ALTER COLUMN delivery_time_slot SET DEFAULT '';
ALTER TABLE orders ALTER COLUMN delivery_notes SET DEFAULT '';
ALTER TABLE orders ALTER COLUMN notes SET DEFAULT '';
ALTER TABLE orders ALTER COLUMN admin_notes SET DEFAULT '';

-- Modify order_items table
ALTER TABLE order_items ALTER COLUMN product_id SET DEFAULT 0;

-- Modify payments table
ALTER TABLE payments ALTER COLUMN payment_method_id SET DEFAULT 0;
ALTER TABLE payments ALTER COLUMN user_id SET DEFAULT 0;
ALTER TABLE payments ALTER COLUMN transaction_id SET DEFAULT '';
ALTER TABLE payments ALTER COLUMN reference_number SET DEFAULT '';
ALTER TABLE payments ALTER COLUMN payment_details SET DEFAULT '{}';
ALTER TABLE payments ALTER COLUMN receipt_image_url SET DEFAULT '';
ALTER TABLE payments ALTER COLUMN admin_notes SET DEFAULT '';
ALTER TABLE payments ALTER COLUMN payment_date SET DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE payments ALTER COLUMN confirmed_date SET DEFAULT CURRENT_TIMESTAMP;

-- Modify product_images table
ALTER TABLE product_images ALTER COLUMN mime_type SET DEFAULT 'image/webp';

-- Modify settings table
ALTER TABLE settings ALTER COLUMN value SET DEFAULT '';

-- Update existing NULL values to appropriate defaults before making columns non-nullable (optional step)
UPDATE users SET
    password_hash = '' WHERE password_hash IS NULL,
    phone = '' WHERE phone IS NULL;

UPDATE orders SET
    user_id = 0 WHERE user_id IS NULL,
    customer_phone = '' WHERE customer_phone IS NULL,
    delivery_zip = '' WHERE delivery_zip IS NULL,
    delivery_date = CURRENT_DATE WHERE delivery_date IS NULL,
    delivery_time_slot = '' WHERE delivery_time_slot IS NULL,
    delivery_notes = '' WHERE delivery_notes IS NULL,
    notes = '' WHERE notes IS NULL,
    admin_notes = '' WHERE admin_notes IS NULL;

UPDATE order_items SET
    product_id = 0 WHERE product_id IS NULL;

UPDATE payments SET
    payment_method_id = 0 WHERE payment_method_id IS NULL,
    user_id = 0 WHERE user_id IS NULL,
    transaction_id = '' WHERE transaction_id IS NULL,
    reference_number = '' WHERE reference_number IS NULL,
    payment_details = '{}' WHERE payment_details IS NULL,
    receipt_image_url = '' WHERE receipt_image_url IS NULL,
    admin_notes = '' WHERE admin_notes IS NULL,
    payment_date = CURRENT_TIMESTAMP WHERE payment_date IS NULL,
    confirmed_date = CURRENT_TIMESTAMP WHERE confirmed_date IS NULL;

UPDATE product_images SET
    mime_type = 'image/webp' WHERE mime_type IS NULL;

UPDATE settings SET
    value = '' WHERE value IS NULL;

-- Add NOT NULL constraints to columns that should not be nullable (optional)
-- ALTER TABLE users ALTER COLUMN password_hash SET NOT NULL;
-- ALTER TABLE users ALTER COLUMN phone SET NOT NULL;
-- ALTER TABLE orders ALTER COLUMN user_id SET NOT NULL;
-- ... and so on for other columns as required by business logic
```

## Notes

1. The script sets appropriate defaults for all nullable columns based on their data types.
2. It also includes UPDATE statements to change existing NULL values to the new default values.
3. The commented NOT NULL constraints can be applied if the business logic requires these fields to be mandatory.
4. This script was automatically generated by analyzing the existing database schema.

> **Warning:** Before running this script in production, test it in a development environment and create a database backup.
