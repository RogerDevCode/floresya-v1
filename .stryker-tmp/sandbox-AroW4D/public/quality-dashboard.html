<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Quality Dashboard - FloresYa</title>
    <link href="css/tailwind.css" rel="stylesheet" />
    <script src="js/chart.min.js"></script>
    <style>
      .metric-card {
        transition: transform 0.2s ease-in-out;
      }
      .metric-card:hover {
        transform: translateY(-2px);
      }
      .status-passed {
        color: #10b981;
      }
      .status-warning {
        color: #f59e0b;
      }
      .status-failed {
        color: #ef4444;
      }
      .progress-ring {
        transform: rotate(-90deg);
      }
      .progress-ring circle {
        transition: stroke-dasharray 0.3s ease;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <header class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Code Quality Dashboard</h1>
        <p class="text-gray-600">Automated code quality metrics and review checklists</p>
        <div class="mt-4 flex items-center space-x-4">
          <button
            id="refreshBtn"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
          >
            ðŸ”„ Refresh Metrics
          </button>
          <button
            id="generateReportBtn"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
          >
            ðŸ“‹ Generate Report
          </button>
          <span id="lastUpdated" class="text-sm text-gray-500"></span>
        </div>
      </header>

      <!-- Overall Score -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-semibold text-gray-900">Overall Quality Score</h2>
          <div class="flex items-center space-x-2">
            <div id="overallScore" class="text-3xl font-bold text-blue-600">--</div>
            <div class="text-sm text-gray-500">/ 100</div>
          </div>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
          <div
            id="overallProgress"
            class="bg-blue-600 h-4 rounded-full transition-all duration-300"
            style="width: 0%"
          ></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
          <div>
            <div id="totalChecks" class="text-2xl font-bold text-gray-900">--</div>
            <div class="text-sm text-gray-600">Total Checks</div>
          </div>
          <div>
            <div id="passedChecks" class="text-2xl font-bold text-green-600">--</div>
            <div class="text-sm text-gray-600">Passed</div>
          </div>
          <div>
            <div id="failedChecks" class="text-2xl font-bold text-red-600">--</div>
            <div class="text-sm text-gray-600">Failed</div>
          </div>
        </div>
      </div>

      <!-- Quality Metrics Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!-- Code Quality -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Code Quality</h3>
            <span id="codeQualityStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">ESLint</span>
              <span id="eslintStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Formatting</span>
              <span id="prettierStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">File Size</span>
              <span id="fileSizeStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>

        <!-- Security -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Security</h3>
            <span id="securityStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Vulnerabilities</span>
              <span id="vulnerabilitiesStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Secrets</span>
              <span id="secretsStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>

        <!-- Testing -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Testing</h3>
            <span id="testingStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Coverage</span>
              <span id="coverageStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Test Files</span>
              <span id="testFilesStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>

        <!-- Performance -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Performance</h3>
            <span id="performanceStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Console Logs</span>
              <span id="consoleLogsStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Bundle Size</span>
              <span id="bundleSizeStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>

        <!-- Documentation -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Documentation</h3>
            <span id="documentationStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">README</span>
              <span id="readmeStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">API Docs</span>
              <span id="apiDocsStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">JSDoc</span>
              <span id="jsdocStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>

        <!-- Architecture -->
        <div class="metric-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Architecture</h3>
            <span id="architectureStatus" class="text-2xl">--</span>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">MVC Layers</span>
              <span id="layersStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Error Handling</span>
              <span id="errorHandlingStatus" class="text-sm font-medium">--</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Validation</span>
              <span id="validationStatus" class="text-sm font-medium">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Checklist -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Detailed Checklist</h2>
        <div id="checklistContainer" class="space-y-4">
          <div class="text-center text-gray-500 py-8">
            <div
              class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"
            ></div>
            Loading checklist...
          </div>
        </div>
      </div>
    </div>

    <script>
      // @ts-nocheck

      let qualityData = null

      async function loadQualityData() {
        try {
          // Try to load from local report file first
          const response = await fetch('/code-review-report.json')
          if (response.ok) {
            qualityData = await response.json()
            updateDashboard()
            return
          }
        } catch (error) {
          console.log('No local report found, will generate new one')
        }

        // If no local report, show loading state
        showLoadingState()
      }

      async function generateReport() {
        try {
          showLoadingState()
          // This would trigger the backend to run the checklist
          // For now, we'll simulate it
          alert('Report generation would be triggered here. Run "npm run code-review" in terminal.')
        } catch (error) {
          console.error('Error generating report:', error)
          alert('Error generating report. Check console for details.')
        }
      }

      function showLoadingState() {
        document.getElementById('overallScore').textContent = '--'
        document.getElementById('overallProgress').style.width = '0%'
        document.getElementById('totalChecks').textContent = '--'
        document.getElementById('passedChecks').textContent = '--'
        document.getElementById('failedChecks').textContent = '--'

        // Reset all status indicators
        const statusElements = document.querySelectorAll('[id$="Status"]')
        statusElements.forEach(el => (el.textContent = '--'))
      }

      function updateDashboard() {
        if (!qualityData) return

        const { checklist, metrics } = qualityData

        // Update overall score
        document.getElementById('overallScore').textContent = metrics.score || 0
        document.getElementById('overallProgress').style.width = `${metrics.score || 0}%`
        document.getElementById('totalChecks').textContent = metrics.totalChecks || 0
        document.getElementById('passedChecks').textContent = metrics.passedChecks || 0
        document.getElementById('failedChecks').textContent =
          metrics.totalChecks - metrics.passedChecks || 0

        // Update last updated time
        const lastUpdated = new Date(qualityData.timestamp).toLocaleString()
        document.getElementById('lastUpdated').textContent = `Last updated: ${lastUpdated}`

        // Update category statuses
        updateCategoryStatus('codeQuality', checklist.codeQuality)
        updateCategoryStatus('security', checklist.security)
        updateCategoryStatus('testing', checklist.testing)
        updateCategoryStatus('performance', checklist.performance)
        updateCategoryStatus('documentation', checklist.documentation)
        updateCategoryStatus('architecture', checklist.architecture)

        // Update detailed checklist
        updateDetailedChecklist(checklist)
      }

      function updateCategoryStatus(category, items) {
        const statusEl = document.getElementById(`${category}Status`)
        const passed = items.filter(item => item.status === 'âœ…').length
        const total = items.length
        const percentage = total > 0 ? Math.round((passed / total) * 100) : 0

        statusEl.textContent = `${percentage}%`
        statusEl.className = getStatusClass(percentage)

        // Update individual metrics
        items.forEach(item => {
          const elementId = getElementIdForItem(item.item)
          if (elementId) {
            const el = document.getElementById(elementId)
            if (el) {
              el.textContent = item.status
              el.className = `text-sm font-medium ${getStatusColorClass(item.status)}`
            }
          }
        })
      }

      function getElementIdForItem(itemName) {
        const mapping = {
          'ESLint violations': 'eslintStatus',
          'Code formatting (Prettier)': 'prettierStatus',
          'File size complexity': 'fileSizeStatus',
          'Security vulnerabilities': 'vulnerabilitiesStatus',
          'Hardcoded secrets detection': 'secretsStatus',
          'Test coverage': 'coverageStatus',
          'Test file coverage': 'testFilesStatus',
          'Console statements in production': 'consoleLogsStatus',
          'CSS bundle size': 'bundleSizeStatus',
          'README.md presence': 'readmeStatus',
          'API documentation': 'apiDocsStatus',
          'JSDoc coverage': 'jsdocStatus',
          'Layer separation (MVC)': 'layersStatus',
          'Global error handling': 'errorHandlingStatus',
          'Input validation': 'validationStatus'
        }
        return mapping[itemName]
      }

      function getStatusClass(percentage) {
        if (percentage >= 80) return 'status-passed'
        if (percentage >= 60) return 'status-warning'
        return 'status-failed'
      }

      function getStatusColorClass(status) {
        switch (status) {
          case 'âœ…':
            return 'text-green-600'
          case 'âš ï¸':
            return 'text-yellow-600'
          case 'âŒ':
            return 'text-red-600'
          default:
            return 'text-gray-600'
        }
      }

      function updateDetailedChecklist(checklist) {
        const container = document.getElementById('checklistContainer')
        container.innerHTML = ''

        Object.keys(checklist).forEach(category => {
          const categoryDiv = document.createElement('div')
          categoryDiv.className = 'mb-6'

          const categoryTitle = document.createElement('h3')
          categoryTitle.className = 'text-lg font-semibold text-gray-900 mb-3 capitalize'
          categoryTitle.textContent = category.replace(/([A-Z])/g, ' $1').trim()
          categoryDiv.appendChild(categoryTitle)

          const itemsDiv = document.createElement('div')
          itemsDiv.className = 'space-y-2'

          checklist[category].forEach(item => {
            const itemDiv = document.createElement('div')
            itemDiv.className = 'flex items-start space-x-3 p-3 bg-gray-50 rounded-lg'

            const statusSpan = document.createElement('span')
            statusSpan.className = 'text-lg'
            statusSpan.textContent = item.status
            itemDiv.appendChild(statusSpan)

            const contentDiv = document.createElement('div')
            contentDiv.className = 'flex-1'

            const titleDiv = document.createElement('div')
            titleDiv.className = 'font-medium text-gray-900'
            titleDiv.textContent = item.item
            contentDiv.appendChild(titleDiv)

            if (item.details) {
              const detailsDiv = document.createElement('div')
              detailsDiv.className = 'text-sm text-gray-600 mt-1'
              detailsDiv.textContent = item.details
              contentDiv.appendChild(detailsDiv)
            }

            itemDiv.appendChild(contentDiv)
            itemsDiv.appendChild(itemDiv)
          })

          categoryDiv.appendChild(itemsDiv)
          container.appendChild(categoryDiv)
        })
      }

      // Event listeners
      document.getElementById('refreshBtn').addEventListener('click', loadQualityData)
      document.getElementById('generateReportBtn').addEventListener('click', generateReport)

      // Load data on page load
      document.addEventListener('DOMContentLoaded', loadQualityData)
    </script>
  </body>
</html>
