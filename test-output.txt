
> floresya-v1@1.0.0 test
> vitest run


 RUN  v3.2.4 /home/manager/Sync/floresya-v1

stdout | tests/functional/comprehensive.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/error-handling-compliance.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/soft-delete-compliance.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/error-handling-compliance-REFACTORED.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/architectural-compliance.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/unit/product-service-with-di.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/unit/repository-pattern.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/business-rules-compliance.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/unit/product-controller-with-di.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/custom-error-compliance.test.js
ðŸ§ª Global test setup completed

stdout | tests/unit/controller/productController.test.js
ðŸ§ª Global test setup completed

stdout | api/controllers/__tests__/productImageController.test.js
ðŸ§ª Global test setup completed

stdout | tests/orders.api.test.js
ðŸ§ª Global test setup completed

stdout | api/controllers/__tests__/userController.test.js
ðŸ§ª Global test setup completed

stdout | tests/architecture/custom-error-compliance.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 1. APPERROR BASE CLASS > should create AppError with default properties 705ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 1. APPERROR BASE CLASS > should create AppError with custom options 168ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 1. APPERROR BASE CLASS > should capture stack trace 705ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create ValidationError with validation details 7ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 2. ERROR SERIALIZATION & RFC 7807 COMPLIANCE > should serialize to RFC 7807 compliant JSON 32ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create NotFoundError with resource details 5ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 2. ERROR SERIALIZATION & RFC 7807 COMPLIANCE > should include stack trace in development mode 50ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create UnauthorizedError with auth context 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 2. ERROR SERIALIZATION & RFC 7807 COMPLIANCE > should exclude undefined values from serialization 9ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create ForbiddenError with access context 17ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 2. ERROR SERIALIZATION & RFC 7807 COMPLIANCE > should generate correct type URLs for different error categories 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create ConflictError with conflict details 26ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 2. ERROR SERIALIZATION & RFC 7807 COMPLIANCE > should generate correct titles for different error types 5ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 5xx Server Errors > should create InternalServerError with critical severity 6ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 4xx Client Errors > should create BadRequestError with correct defaults 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > HTTP 5xx Server Errors > should create ServiceUnavailableError with service context 221ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Database Errors > should create DatabaseError with operation details 506ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Database Errors > should create DatabaseConnectionError with connection context 759ms
stdout | tests/unit/controller/productController.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Database Errors > should create DatabaseConstraintError with constraint details 16403ms
 Ã— tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Business Logic Errors > should create InsufficientStockError with inventory details 88434ms
   â†’ Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Business Logic Errors > should create PaymentFailedError with payment context 211ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Configuration Errors > should create ConfigurationError with critical severity 47ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 4. ERROR SEVERITY LEVELS > should assign correct severity levels to different error types 6ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 4. ERROR SEVERITY LEVELS > should default to appropriate severity based on status code 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 4. ERROR SEVERITY LEVELS > should allow custom severity override 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 5. ERROR CONTEXT & METADATA > should preserve and merge context metadata 7ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 5. ERROR CONTEXT & METADATA > should include request ID in context when available 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 5. ERROR CONTEXT & METADATA > should sanitize sensitive context data in serialization 4ms
stdout | tests/architecture/custom-error-compliance.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 6. ERROR HANDLING SCENARIOS > should handle error inheritance correctly 3ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 6. ERROR HANDLING SCENARIOS > should maintain error properties through inheritance 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 6. ERROR HANDLING SCENARIOS > should handle errors with circular references in context 22ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 6. ERROR HANDLING SCENARIOS > should handle errors with complex nested context 5ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 7. VITEST & MOCKING BEST PRACTICES > should properly mock AppError classes for testing 2ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 7. VITEST & MOCKING BEST PRACTICES > should test error serialization without side effects 1ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 7. VITEST & MOCKING BEST PRACTICES > should isolate error instances between tests 3ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 7. VITEST & MOCKING BEST PRACTICES > should handle async error scenarios 14ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 8. ERROR CODES INTEGRATION > should use correct error codes from ERROR_CODES constant 23ms
 âœ“ tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 8. ERROR CODES INTEGRATION > should provide correct error categories 1ms
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should return products with default filters 117420ms
   â†’ Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply search term from query 158ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by featured when query param is true 149ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by occasion slug 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by featured when query param is false 34ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply sorting by price ascending 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply pagination with limit 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should include images when includeImageSize is specified 22ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should return empty array when no products found 13ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return product by valid ID 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return product with images when specified 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should handle string ID parameter 46ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
stdout | tests/unit/controller/productController.test.js
ðŸ§¹ DI Container and mocks cleaned up

 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should include deactivated products for admin 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return 404 when product not found 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should create product with valid data 17ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should return 400 when validation fails 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should return 400 when SKU already exists 12ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should update product with valid data 9ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should return 404 when product not found 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should return 400 when validation fails 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > deleteProduct() > should deactivate product (soft delete) 18ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > deleteProduct() > should return 404 when product not found 13ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should decrement product stock 21ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should return 400 when quantity is invalid 1ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should return 400 when stock is insufficient 10ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
 Ã— tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateCarouselOrder() > should update carousel order for product 8ms
   â†’ [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
stdout | tests/orders.api.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should return all orders with default filters 259ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should filter orders by user_id 80ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should filter orders by status 218ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should apply search filter 31ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should apply pagination 25ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders > should handle service errors 70ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/:id > should return order by ID 9ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/:id > should handle invalid order ID 8ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/:id > should return 404 for non-existent order 9ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/user/:userId > should return orders for specific user 10ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/user/:userId > should filter user orders by status 12ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/user/:userId > should apply limit to user orders 8ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/:id/status-history > should return order status history 7ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > GET /api/orders/:id/status-history > should return 404 for order with no history 13ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > POST /api/orders > should create order with valid data 94ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > POST /api/orders > should validate required order fields 6ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > POST /api/orders > should require order items 6ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PUT /api/orders/:id > should update order with valid data 27ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PUT /api/orders/:id > should return 404 for non-existent order 8ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PATCH /api/orders/:id/status > should update order status 8ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PATCH /api/orders/:id/status > should validate status value 16ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PATCH /api/orders/:id/cancel > should cancel order 13ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > PATCH /api/orders/:id/cancel > should cancel order with default notes 6ms
stdout | tests/orders.api.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/orders.api.test.js > Order API Integration Tests > Error Handling > should handle database errors gracefully 26ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > Error Handling > should handle validation errors 13ms
 âœ“ tests/orders.api.test.js > Order API Integration Tests > Error Handling > should handle not found errors 8ms
stdout | api/__tests__/integration/admin-panel.test.js
ðŸ§ª Global test setup completed

stdout | tests/unit/services/ProductService.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/integration/general-api.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/integration/shopping-cart.test.js
ðŸ§ª Global test setup completed

stdout | tests/unit/services/ProductService.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

stdout | tests/unit/controller/orderController.test.js
ðŸ§ª Global test setup completed

stdout | tests/unit/controller/userController.test.js
ðŸ§ª Global test setup completed

 Ã— tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should return products with default filters 15180ms
   â†’ Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stdout | tests/unit/controller/userController.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

stdout | tests/unit/controller/orderController.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by featured products
[32m[INFO][0m {"timestamp":"2025-11-13T16:42:31.392Z","level":"INFO","message":"Creating monitored Supabase client for database query tracking","caller":{"function":"createMonitoredSupabaseClient","file":"/home/manager/Sync/floresya-v1/api/monitoring/databaseMonitor.js:136:10"},"context":{}}

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by featured products
ðŸ” Query filters: { occasionId: [1mnull[22m, includeDeactivated: [33mfalse[39m, includeImageSize: [1mnull[22m }
ðŸ” Query filters: {
  featured: [33mtrue[39m,
  occasionId: [1mnull[22m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}
ðŸ“¦ getAllProducts: Found 1 products from database
ðŸ“¦ getAllProducts: Found 1 products from database

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should apply pagination
ðŸ” Query filters: {
  limit: [33m10[39m,
  offset: [33m0[39m,
  occasionId: [1mnull[22m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should apply pagination
ðŸ“¦ getAllProducts: Found 1 products from database

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should sort by price ascending
ðŸ” Query filters: {
  sortBy: [32m'price_asc'[39m,
  occasionId: [1mnull[22m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should sort by price ascending
ðŸ“¦ getAllProducts: Found 1 products from database

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by occasion slug
ðŸ” Resolved occasion slug "birthday" to ID 1
ðŸ” Query filters: {
  occasion: [32m'birthday'[39m,
  occasionId: [33m1[39m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}

stdout | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by occasion slug
ðŸ“¦ getAllProducts: Found 1 products from database

 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by featured products 1401ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should apply pagination 12ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should sort by price ascending 18ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should filter by occasion slug 43ms
stderr | tests/unit/services/ProductService.test.js > ProductService - Framework Tests > deleteProduct() > should throw NotFoundError when product does not exist
deleteProduct(999) failed: Error: Product not found
    at [90m/home/manager/Sync/floresya-v1/[39mtests/unit/services/ProductService.test.js:431:47
    at [90mfile:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at runSuite [90m(file:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///home/manager/Sync/floresya-v1/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductById() > should throw error for invalid ID 33ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductById() > should return product by valid ID 22ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductById() > should throw NotFoundError when product not found 11ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductById() > should include deactivated for admin 6ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > createProduct() > should create product with valid data 7ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > createProduct() > should check SKU uniqueness 6ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > createProduct() > should sanitize input data 6ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > updateProduct() > should update product with valid data 7ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > updateProduct() > should throw NotFoundError when product does not exist 7ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > deleteProduct() > should soft delete product 8ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > deleteProduct() > should throw NotFoundError when product does not exist 10ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should return all orders with default filters 520ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should filter by status 7ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should filter by date range 20ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should apply search term 14ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should include deactivated orders for admin 25ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should apply pagination 20ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > decrementProductStock() > should decrement stock by specified quantity 27ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > decrementProductStock() > should throw error when stock is insufficient 15ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > decrementProductStock() > should handle quantity of 1 11ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductsByOccasion() > should filter by occasion ID 20ms
 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductsByOccasion() > should filter by occasion slug 24ms
stdout | tests/unit/services/ProductService.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getProductsByOccasion() > should apply pagination 46ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getAllOrders() > should return empty array when no orders found 23ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getOrderById() > should return order by valid ID 54ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getOrderById() > should include deactivated order for admin 17ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should return all users with default filters 820ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should filter by role 2ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should include deactivated users for admin 25ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should apply search term 2ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should apply pagination 21ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getAllUsers() > should return empty array when no users found 19ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > getOrderById() > should return 404 when order not found 27ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > createOrder() > should create order with valid data 19ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > createOrder() > should return 400 when validation fails 39ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > createOrder() > should return 400 when products are invalid 14ms
stdout | tests/unit/controller/orderController.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getUserById() > should return user by valid ID 27ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getUserById() > should include deactivated user for admin 19ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getUserById() > should return 404 when user not found 19ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > getUserById() > should handle string ID parameter 33ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should update order status to processing 21ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should update order status to shipped 9ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should update order status to delivered 1ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should cancel order with reason 16ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should return 400 for invalid status 4ms
 âœ“ tests/unit/controller/orderController.test.js > OrderController - Granular Tests > updateOrderStatus() > should return 404 when order not found 15ms
stdout | tests/unit/controller/userController.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > createUser() > should create user with valid data 37ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > createUser() > should return 400 when validation fails 15ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > createUser() > should return 400 when email already exists 15ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > updateUser() > should update user with valid data 7ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > updateUser() > should return 404 when user not found 5ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > updateUser() > when updating user role > should update user role 5ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > updateUser() > when updating user role > should return 400 for invalid role 2ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > deleteUser() > should deactivate user (soft delete) 3ms
 âœ“ tests/unit/controller/userController.test.js > UserController - Granular Tests > deleteUser() > should return 404 when user not found 2ms
stdout | api/__tests__/integration/admin-panel.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | api/__tests__/integration/general-api.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | api/__tests__/integration/shopping-cart.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | tests/unit/middleware/auth.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/integration/shopping-cart.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:42:36.012Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | api/__tests__/integration/admin-panel.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:42:36.037Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | api/__tests__/integration/general-api.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:42:36.124Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | tests/unit/services/businessRules.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/unit/supabase-mocking-demo.test.js
ðŸ§ª Global test setup completed

stdout | tests/performance/service-performance.test.js
ðŸ§ª Global test setup completed

stdout | tests/integration/modular-service-integration.test.js
ðŸ§ª Global test setup completed

stdout | tests/unit/services/businessRules.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateOrderAmount > should validate amount within business limits 71ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductStock > should handle very large stock 28ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject invalid phone format 18ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateOrderAmount > should reject amount below minimum 43ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > enforceBusinessHours > should allow orders during business hours 72ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateOrderAmount > should reject amount above maximum 24ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePriceRange > should validate price within range 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateDeliveryAddress > should validate complete address 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > enforceBusinessHours > should allow orders at business hour boundary 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateOrderAmount > should handle negative amounts 9ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePriceRange > should reject price below minimum 21ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateDeliveryAddress > should reject too short address 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateOrderAmount > should handle zero amount 17ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > enforceBusinessHours > should reject orders outside business hours 9ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePriceRange > should reject price above maximum 6ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateDeliveryAddress > should reject too long address 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePriceRange > should handle zero price 16ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateDeliveryAddress > should reject empty address 5ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductStock > should validate positive stock 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > enforceBusinessHours > should reject orders on weekend 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePriceRange > should handle negative price 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateDeliveryAddress > should reject whitespace-only address 5ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductStock > should reject negative stock 15ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCarouselLimit > should allow carousel within limit 20ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductStock > should reject zero stock 8ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should validate complete customer info 19ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePaymentAmount > should validate payment amount matching order 8ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCarouselLimit > should reject carousel at max limit 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject missing email 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePaymentAmount > should validate partial payment 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCarouselLimit > should reject carousel beyond limit 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject invalid email format 7ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePaymentAmount > should reject payment exceeding order amount 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCarouselLimit > should reject negative limit 45ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject missing name 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePaymentAmount > should reject negative payment 15ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCarouselLimit > should reject zero limit 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject short name 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validatePaymentAmount > should reject zero payment 3ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductImages > should validate single image 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateCustomerInfo > should reject missing phone 10ms
stdout | tests/unit/services/businessRules.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductImages > should validate multiple images within limit 28ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductImages > should reject too many images 18ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductImages > should reject empty images 1ms
 âœ“ tests/unit/services/businessRules.test.js > businessRules > validateProductImages > should reject missing URL 31ms
stdout | tests/integration/modular-service-integration.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > ProductService with BaseRepository > should use BaseRepository pattern correctly 1144ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > OrderService Integration > should have all modular operations available 349ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > PaymentService Integration > should have all modular operations available 3038ms
stdout | api/__tests__/unit/supabase-mocking-demo.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | api/__tests__/integration/shopping-cart.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:14.544Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

stdout | api/__tests__/integration/general-api.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:14.564Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

stdout | api/__tests__/integration/admin-panel.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:14.675Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > UserService Integration > should have all modular operations available 1336ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > SettingsService Integration > should have all modular operations available 663ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > AuthService Integration > should have all modular operations available 220ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Middleware Validation Integration > should have all validation schemas available 192ms
stdout | api/__tests__/unit/supabase-mocking-demo.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:16.527Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Auth Middleware Integration > should have all auth middleware available 1673ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Error Mapping Integration > should have error mapping functions available 19ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Advanced Validation Integration > should have all validation functions available 185ms
 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Service Layer Contract > should maintain consistent error handling across services 17ms
stdout | tests/integration/modular-service-integration.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/integration/modular-service-integration.test.js > Modular Services Integration > Repository Pattern Contract > should provide unified repository interface 99ms
stdout | api/__tests__/integration/general-api.test.js
ðŸ”§ Using custom contract validation system...

stdout | api/__tests__/integration/admin-panel.test.js
ðŸ”§ Using custom contract validation system...

stdout | api/__tests__/integration/shopping-cart.test.js
ðŸ”§ Using custom contract validation system...

stdout | api/__tests__/integration/general-api.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | api/__tests__/integration/shopping-cart.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | api/__tests__/integration/admin-panel.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | api/__tests__/integration/product-catalog.test.js
ðŸ§ª Global test setup completed

stdout | tests/simple-test.test.mjs
ðŸ§ª Global test setup completed

stdout | tests/simple-test.test.mjs
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Basic Supabase Operations > should mock select query successfully 50ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Basic Supabase Operations > should handle select query errors 12ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Basic Supabase Operations > should mock insert operation 4ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Basic Supabase Operations > should mock update operation 8ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Basic Supabase Operations > should mock delete operation 9ms
stdout | tests/simple-test.test.mjs
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Storage Operations > should mock file upload 9ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > Storage Operations > should mock public URL generation 2ms
 âœ“ tests/simple-test.test.mjs > Supabase Client Mocking Tests > RPC Operations > should mock stored procedure calls 3ms
stdout | tests/integration/api/orders.integration.test.js
ðŸ§ª Global test setup completed

stdout | tests/integration/api/products.integration.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/integration/product-catalog.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | api/__tests__/integration/product-catalog.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:22.505Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | api/__tests__/unit/simple-mocking-demo.test.js
ðŸ§ª Global test setup completed

stdout | api/__tests__/unit/simple-mocking-demo.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Data Factories > should generate consistent test data 23ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Data Factories > should support data overrides 2ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Supabase Client Creation > should create a mock Supabase client with default responses 5ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Supabase Client Creation > should create mock client with custom responses 2ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Query Builder > should create a mock query builder 4ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Query Builder > should support method chaining 9ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Query Builder > should resolve with mock data 30ms
stdout | api/__tests__/unit/simple-mocking-demo.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Query Builder > should support error responses 12ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Database Simulation > should simulate database operations 9ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Database Simulation > should handle not found errors 2ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Database Simulation > should support bulk operations 8ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Supabase with Auth and Storage > should mock auth operations 6ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Supabase with Auth and Storage > should mock storage operations 8ms
 âœ“ api/__tests__/unit/simple-mocking-demo.test.js > Simple Supabase Mocking Demo > Mock Supabase with Auth and Storage > should create storage bucket mock 11ms
stdout | api/__tests__/integration/product-catalog.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:25.418Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

stdout | api/__tests__/integration/product-catalog.test.js
ðŸ”§ Using custom contract validation system...

stdout | api/__tests__/integration/product-catalog.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | tests/integration/api/orders.integration.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | tests/integration/api/products.integration.test.js
Loading OpenAPI spec from: /home/manager/Sync/floresya-v1/api/docs/openapi-spec.json
Successfully loaded OpenAPI spec with [33m23[39m schemas
Available schemas: [
  [32m'SuccessResponse'[39m,
  [32m'ErrorResponse'[39m,
  [32m'user'[39m,
  [32m'product'[39m,
  [32m'occasion'[39m,
  [32m'productimage'[39m,
  [32m'order'[39m,
  [32m'OrderItem'[39m,
  [32m'OrderStatusHistory'[39m,
  [32m'payment'[39m,
  [32m'settings'[39m,
  [32m'PaginationParams'[39m,
  [32m'OrderStatusUpdate'[39m,
  [32m'PaymentConfirm'[39m,
  [32m'OrderCreate'[39m,
  [32m'ErrorCode'[39m,
  [32m'ErrorCodeList'[39m,
  [32m'ValidationErrorResponse'[39m,
  [32m'NotFoundErrorResponse'[39m,
  [32m'AuthErrorResponse'[39m,
  [32m'ConflictErrorResponse'[39m,
  [32m'ServerErrorResponse'[39m,
  [32m'paymentMethod'[39m
]

stdout | tests/integration/api/products.integration.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:45.659Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | tests/integration/api/orders.integration.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:43:45.678Z","level":"INFO","message":"ðŸ”§ Sistema de recuperaciÃ³n automÃ¡tica iniciado","caller":{"function":"AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12","file":"at AutoRecoverySystem.start (/home/manager/Sync/floresya-v1/api/recovery/autoRecovery.js:42:12)"},"context":{}}

stdout | tests/integration/api/orders.integration.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:26.040Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

stdout | tests/integration/api/products.integration.test.js
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:26.045Z","level":"INFO","message":"âš™ï¸ Motor de reglas de negocio inicializado","caller":{"function":"BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17","file":"at BusinessRulesEngine.initializeDefaultRules (/home/manager/Sync/floresya-v1/api/services/businessRules.js:154:17)"},"context":{}}

stdout | tests/integration/api/orders.integration.test.js
ðŸ”§ Using custom contract validation system...

stdout | tests/integration/api/products.integration.test.js
ðŸ”§ Using custom contract validation system...

stdout | tests/integration/api/products.integration.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | tests/integration/api/orders.integration.test.js
âœ… Custom contract validation system initialized successfully
ðŸ“‹ Contract validation available via: npm run validate:contract

stdout | tests/integration/api/orders.integration.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

stdout | tests/integration/api/products.integration.test.js
âœ… Global test setup completed - Supabase mocked and DI Container configured

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:31.315Z","level":"INFO","message":"GET /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052271289_1","method":"GET","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052271289_1"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should return successful response with empty products array
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:31.315Z","level":"INFO","message":"GET /api/products","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052271288_1","method":"GET","url":"/api/products","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052271288_1"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should return successful response with empty products array
ðŸ” Query filters: {
  featured: [90mundefined[39m,
  sku: [90mundefined[39m,
  search: [90mundefined[39m,
  occasion: [90mundefined[39m,
  sortBy: [90mundefined[39m,
  limit: [90mundefined[39m,
  offset: [90mundefined[39m,
  occasionId: [1mnull[22m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should return successful response with empty products array
ðŸ“¦ getAllProducts: Found 0 products from database

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should return successful response with empty products array
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:35.393Z","level":"INFO","message":"Response: 200 (3810ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052271288_1","statusCode":200,"duration":"3810ms","method":"GET","url":"/"},"requestId":"req_1763052271288_1"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:33.036Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:33.603Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:34.080Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:33.429Z","context":{"path":"/","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052271289_1","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at requestMetrics (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:306:3)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:414:5\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitAdmin (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:245:39)\n    at protectAdminOperations (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:404:3)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)"}},"requestId":"req_1763052271289_1"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should handle query parameters
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:37.180Z","level":"INFO","message":"GET /api/products?limit=10&offset=0","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052277179_2","method":"GET","url":"/api/products?limit=10&offset=0","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052277179_2"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:37.180Z","level":"WARN","message":"Response: 401 (5688ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052271289_1","statusCode":401,"duration":"5688ms","method":"GET","url":"/api/orders"},"requestId":"req_1763052271289_1"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Slow request detected: GET /api/orders - 4644ms

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should handle query parameters
ðŸ” Query filters: {
  featured: [90mundefined[39m,
  sku: [90mundefined[39m,
  search: [90mundefined[39m,
  occasion: [90mundefined[39m,
  sortBy: [90mundefined[39m,
  limit: [32m'10'[39m,
  offset: [32m'0'[39m,
  occasionId: [1mnull[22m,
  includeDeactivated: [33mfalse[39m,
  includeImageSize: [1mnull[22m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should handle query parameters
ðŸ“¦ getAllProducts: Found 0 products from database

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should handle query parameters
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:37.202Z","level":"INFO","message":"Response: 200 (18ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052277179_2","statusCode":200,"duration":"18ms","method":"GET","url":"/?limit=10&offset=0"},"requestId":"req_1763052277179_2"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:39.921Z","level":"INFO","message":"GET /api/products/carousel","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052277912_3","method":"GET","url":"/api/products/carousel","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052277912_3"}

 âœ“ tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should return successful response with empty products array 8938ms
 âœ“ tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products > should handle query parameters 66ms
stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
getCarouselProducts failed: NotFoundError: Carousel products with ID undefined not found
    at Module.getCarouselProducts [90m(/home/manager/Sync/floresya-v1/[39mapi/services/productService.js:312:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/controllers/productController.js:87:22 {
  statusCode: [33m404[39m,
  status: [32m'fail'[39m,
  isOperational: [33mtrue[39m,
  code: [33m3001[39m,
  context: { resource: [32m'Carousel products'[39m, id: [90mundefined[39m },
  userMessage: [32m'The requested carousel products was not found.'[39m,
  timestamp: [32m'2025-11-13T16:44:39.992Z'[39m,
  severity: [32m'low'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
ðŸ” [DEBUG] getCarouselProducts - Featured products from database: { count: [33m0[39m, products: [] }

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.307Z","level":"INFO","message":"GET /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280303_2","method":"GET","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280303_2"}

 âœ“ tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 401 for unauthenticated requests 11965ms
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.313Z","level":"ERROR","message":"LOW ERROR: NotFoundError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"NotFoundError","errorCode":3001,"statusCode":404,"severity":"low","path":"/api/products/carousel","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:39.992Z","context":{"resource":"Carousel products"},"isOperational":true,"requestId":"req_1763052277912_3","error":{"name":"NotFoundError","message":"Carousel products with ID undefined not found","stack":"NotFoundError: Carousel products with ID undefined not found\n    at Module.getCarouselProducts (/home/manager/Sync/floresya-v1/api/services/productService.js:312:13)\n    at /home/manager/Sync/floresya-v1/api/controllers/productController.js:87:22"}},"requestId":"req_1763052277912_3"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.374Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.389Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.414Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.389Z","context":{"path":"/","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052280303_2","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at requestMetrics (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:306:3)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:414:5\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitAdmin (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:245:39)\n    at protectAdminOperations (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:404:3)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)"}},"requestId":"req_1763052280303_2"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.434Z","level":"WARN","message":"Response: 401 (115ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280303_2","statusCode":401,"duration":"115ms","method":"GET","url":"/api/orders"},"requestId":"req_1763052280303_2"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.434Z","level":"WARN","message":"Response: 404 (485ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052277912_3","statusCode":404,"duration":"485ms","method":"GET","url":"/api/products/carousel"},"requestId":"req_1763052277912_3"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.465Z","level":"INFO","message":"GET /api/orders/1","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280465_3","method":"GET","url":"/api/orders/1","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280465_3"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.476Z","level":"INFO","message":"GET /api/products/with-occasions","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280476_4","method":"GET","url":"/api/products/with-occasions","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280476_4"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
getProductsWithOccasions failed: NotFoundError: Products with ID undefined not found
    at Module.getProductsWithOccasions [90m(/home/manager/Sync/floresya-v1/[39mapi/services/productService.js:246:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/controllers/productController.js:141:22 {
  statusCode: [33m404[39m,
  status: [32m'fail'[39m,
  isOperational: [33mtrue[39m,
  code: [33m3001[39m,
  context: { resource: [32m'Products'[39m, id: [90mundefined[39m },
  userMessage: [32m'The requested products was not found.'[39m,
  timestamp: [32m'2025-11-13T16:44:40.486Z'[39m,
  severity: [32m'low'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.494Z","level":"ERROR","message":"LOW ERROR: NotFoundError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"NotFoundError","errorCode":3001,"statusCode":404,"severity":"low","path":"/api/products/with-occasions","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.486Z","context":{"resource":"Products"},"isOperational":true,"requestId":"req_1763052280476_4","error":{"name":"NotFoundError","message":"Products with ID undefined not found","stack":"NotFoundError: Products with ID undefined not found\n    at Module.getProductsWithOccasions (/home/manager/Sync/floresya-v1/api/services/productService.js:246:13)\n    at /home/manager/Sync/floresya-v1/api/controllers/productController.js:141:22"}},"requestId":"req_1763052280476_4"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.506Z","level":"WARN","message":"Response: 404 (27ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280476_4","statusCode":404,"duration":"27ms","method":"GET","url":"/api/products/with-occasions"},"requestId":"req_1763052280476_4"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.471Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/1","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.475Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/1","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.478Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders/1","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.474Z","context":{"path":"/1","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052280465_3","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitCritical (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:259:41)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)"}},"requestId":"req_1763052280465_3"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.583Z","level":"WARN","message":"Response: 401 (82ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280465_3","statusCode":401,"duration":"82ms","method":"GET","url":"/api/orders/1"},"requestId":"req_1763052280465_3"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

 âœ“ tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders (Admin Only) > should return 403 for non-admin users 276ms
 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully 3259ms
   â†’ expected 200 "OK", got 404 "Not Found"
 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully 76ms
   â†’ expected 200 "OK", got 404 "Not Found"
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.609Z","level":"INFO","message":"GET /api/products/occasion/1","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280596_5","method":"GET","url":"/api/products/occasion/1","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280596_5"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.671Z","level":"INFO","message":"GET /api/orders/invalid-id","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280668_4","method":"GET","url":"/api/orders/invalid-id","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280668_4"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
getProductsByOccasion(1) failed: BadRequestError: Invalid occasion ID: must be a number
    at Module.getProductsByOccasion [90m(/home/manager/Sync/floresya-v1/[39mapi/services/productService.js:270:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/controllers/productController.js:190:43
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:110:21
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at Route.dispatch [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:117:3[90m)[39m
    at handle [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:435:11[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:295:15
    at param [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:600:14[90m)[39m {
  statusCode: [33m400[39m,
  status: [32m'fail'[39m,
  isOperational: [33mtrue[39m,
  code: [33m1002[39m,
  context: { occasionId: [32m'1'[39m },
  userMessage: [32m'Invalid request. Please check your input.'[39m,
  timestamp: [32m'2025-11-13T16:44:40.627Z'[39m,
  severity: [32m'low'[39m
}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.681Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/invalid-id","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.685Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/invalid-id","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.688Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders/invalid-id","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.684Z","context":{"path":"/invalid-id","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052280668_4","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitCritical (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:259:41)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)"}},"requestId":"req_1763052280668_4"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.688Z","level":"ERROR","message":"LOW ERROR: BadRequestError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"BadRequestError","errorCode":1002,"statusCode":400,"severity":"low","path":"/api/products/occasion/1","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.627Z","context":{"occasionId":"1"},"isOperational":true,"requestId":"req_1763052280596_5","error":{"name":"BadRequestError","message":"Invalid occasion ID: must be a number","stack":"BadRequestError: Invalid occasion ID: must be a number\n    at Module.getProductsByOccasion (/home/manager/Sync/floresya-v1/api/services/productService.js:270:13)\n    at /home/manager/Sync/floresya-v1/api/controllers/productController.js:190:43\n    at /home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:110:21\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at /home/manager/Sync/floresya-v1/node_modules/router/index.js:295:15\n    at param (/home/manager/Sync/floresya-v1/node_modules/router/index.js:600:14)"}},"requestId":"req_1763052280596_5"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.707Z","level":"WARN","message":"Response: 400 (90ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280596_5","statusCode":400,"duration":"90ms","method":"GET","url":"/api/products/occasion/1"},"requestId":"req_1763052280596_5"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.757Z","level":"INFO","message":"GET /api/products/occasion/999","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280756_6","method":"GET","url":"/api/products/occasion/999","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280756_6"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
getProductsByOccasion(999) failed: BadRequestError: Invalid occasion ID: must be a number
    at Module.getProductsByOccasion [90m(/home/manager/Sync/floresya-v1/[39mapi/services/productService.js:270:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/controllers/productController.js:190:43
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:110:21
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at Route.dispatch [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:117:3[90m)[39m
    at handle [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:435:11[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:295:15
    at param [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:600:14[90m)[39m {
  statusCode: [33m400[39m,
  status: [32m'fail'[39m,
  isOperational: [33mtrue[39m,
  code: [33m1002[39m,
  context: { occasionId: [32m'999'[39m },
  userMessage: [32m'Invalid request. Please check your input.'[39m,
  timestamp: [32m'2025-11-13T16:44:40.765Z'[39m,
  severity: [32m'low'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.774Z","level":"WARN","message":"Response: 401 (101ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280668_4","statusCode":401,"duration":"101ms","method":"GET","url":"/api/orders/invalid-id"},"requestId":"req_1763052280668_4"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

 âœ“ tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should return 401 for unauthenticated requests 163ms
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:40.776Z","level":"ERROR","message":"LOW ERROR: BadRequestError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"BadRequestError","errorCode":1002,"statusCode":400,"severity":"low","path":"/api/products/occasion/999","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:40.765Z","context":{"occasionId":"999"},"isOperational":true,"requestId":"req_1763052280756_6","error":{"name":"BadRequestError","message":"Invalid occasion ID: must be a number","stack":"BadRequestError: Invalid occasion ID: must be a number\n    at Module.getProductsByOccasion (/home/manager/Sync/floresya-v1/api/services/productService.js:270:13)\n    at /home/manager/Sync/floresya-v1/api/controllers/productController.js:190:43\n    at /home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:110:21\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at /home/manager/Sync/floresya-v1/node_modules/router/index.js:295:15\n    at param (/home/manager/Sync/floresya-v1/node_modules/router/index.js:600:14)"}},"requestId":"req_1763052280756_6"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:40.801Z","level":"WARN","message":"Response: 400 (38ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280756_6","statusCode":400,"duration":"38ms","method":"GET","url":"/api/products/occasion/999"},"requestId":"req_1763052280756_6"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully 183ms
   â†’ expected 200 "OK", got 400 "Bad Request"
 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs 89ms
   â†’ expected 200 "OK", got 400 "Bad Request"
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should return product by SKU successfully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.875Z","level":"INFO","message":"GET /api/products/sku/TEST-001","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052280874_7","method":"GET","url":"/api/products/sku/TEST-001","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052280874_7"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should return product by SKU successfully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:40.928Z","level":"INFO","message":"Response: 200 (32ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052280874_7","statusCode":200,"duration":"32ms","method":"GET","url":"/sku/TEST-001"},"requestId":"req_1763052280874_7"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should handle different SKU formats
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.074Z","level":"INFO","message":"GET /api/products/sku/ABC-123-XYZ","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281073_8","method":"GET","url":"/api/products/sku/ABC-123-XYZ","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281073_8"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should accept valid order creation requests
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.091Z","level":"INFO","message":"POST /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281078_5","method":"POST","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281078_5"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should accept valid order creation requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should accept valid order creation requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.100Z","level":"WARN","message":"Response: 403 (8ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281078_5","statusCode":403,"duration":"8ms","method":"POST","url":"/api/orders"},"requestId":"req_1763052281078_5"}

 âœ“ tests/integration/api/orders.integration.test.js > Orders API Integration Tests > GET /api/orders/:id > should validate ID parameter format 193ms
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should handle different SKU formats
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.126Z","level":"INFO","message":"Response: 200 (50ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281073_8","statusCode":200,"duration":"50ms","method":"GET","url":"/sku/ABC-123-XYZ"},"requestId":"req_1763052281073_8"}

 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should return product by SKU successfully 217ms
   â†’ expected { Object (success, data, ...) } to deeply equal { success: true, data: {}, â€¦(1) }
stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.170Z","level":"INFO","message":"GET /api/products/non-existent-route","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281170_9","method":"GET","url":"/api/products/non-existent-route","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281170_9"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject invalid order data
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.181Z","level":"INFO","message":"POST /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281180_6","method":"POST","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281180_6"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject invalid order data
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject invalid order data
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.183Z","level":"WARN","message":"Response: 403 (2ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281180_6","statusCode":403,"duration":"2ms","method":"POST","url":"/api/orders"},"requestId":"req_1763052281180_6"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:41.184Z","level":"ERROR","message":"LOW ERROR: ValidationError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"ValidationError","errorCode":1001,"statusCode":400,"severity":"low","path":"/api/products/non-existent-route","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:41.173Z","context":{"validationErrors":{"id":["Must be a positive integer"]}},"isOperational":true,"requestId":"req_1763052281170_9","error":{"name":"ValidationError","message":"Validation failed","stack":"ValidationError: Validation failed\n    at /home/manager/Sync/floresya-v1/api/middleware/validation/validate.validators.js:143:21\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at /home/manager/Sync/floresya-v1/node_modules/router/index.js:295:15\n    at param (/home/manager/Sync/floresya-v1/node_modules/router/index.js:600:14)\n    at param (/home/manager/Sync/floresya-v1/node_modules/router/index.js:610:14)\n    at processParams (/home/manager/Sync/floresya-v1/node_modules/router/index.js:664:3)"}},"requestId":"req_1763052281170_9"}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.199Z","level":"WARN","message":"Response: 400 (28ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281170_9","statusCode":400,"duration":"28ms","method":"GET","url":"/api/products/non-existent-route"},"requestId":"req_1763052281170_9"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.211Z","level":"INFO","message":"GET /api/products/occasion/invalid-id","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281211_10","method":"GET","url":"/api/products/occasion/invalid-id","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281211_10"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject malformed JSON
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:41.212Z","level":"ERROR","message":"CRITICAL ERROR: InternalServerError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"InternalServerError","errorCode":5001,"statusCode":500,"severity":"critical","path":"/api/orders","method":"POST","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:41.212Z","context":{"originalError":"Unexpected token 'i', \"invalid json {\" is not valid JSON","originalStatusCode":400,"stack":"SyntaxError: Unexpected token 'i', \"invalid json {\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at createStrictSyntaxError (/home/manager/Sync/floresya-v1/node_modules/body-parser/lib/types/json.js:156:10)\n    at parse (/home/manager/Sync/floresya-v1/node_modules/body-parser/lib/types/json.js:71:15)\n    at /home/manager/Sync/floresya-v1/node_modules/body-parser/lib/read.js:123:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:238:16)\n    at done (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:524:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)"},"isOperational":false,"error":{"name":"InternalServerError","message":"Unexpected token 'i', \"invalid json {\" is not valid JSON","stack":"SyntaxError: Unexpected token 'i', \"invalid json {\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at createStrictSyntaxError (/home/manager/Sync/floresya-v1/node_modules/body-parser/lib/types/json.js:156:10)\n    at parse (/home/manager/Sync/floresya-v1/node_modules/body-parser/lib/types/json.js:71:15)\n    at /home/manager/Sync/floresya-v1/node_modules/body-parser/lib/read.js:123:18\n    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)\n    at invokeCallback (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:238:16)\n    at done (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:227:7)\n    at IncomingMessage.onEnd (/home/manager/Sync/floresya-v1/node_modules/raw-body/index.js:287:7)\n    at IncomingMessage.emit (node:events:524:28)\n    at endReadableNT (node:internal/streams/readable:1698:12)"}}}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject malformed JSON
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should accept valid order creation requests 371ms
   â†’ expected [ 200, 201, 400, 401, 500 ] to include 403
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject invalid order data 14ms
   â†’ expected [ 400, 401, 422 ] to include 403
stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
getProductsByOccasion(invalid-id) failed: BadRequestError: Invalid occasion ID: must be a number
    at Module.getProductsByOccasion [90m(/home/manager/Sync/floresya-v1/[39mapi/services/productService.js:270:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/controllers/productController.js:190:43
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:110:21
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at Route.dispatch [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:117:3[90m)[39m
    at handle [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:435:11[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:295:15
    at param [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:600:14[90m)[39m {
  statusCode: [33m400[39m,
  status: [32m'fail'[39m,
  isOperational: [33mtrue[39m,
  code: [33m1002[39m,
  context: { occasionId: [32m'invalid-id'[39m },
  userMessage: [32m'Invalid request. Please check your input.'[39m,
  timestamp: [32m'2025-11-13T16:44:41.213Z'[39m,
  severity: [32m'low'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:41.232Z","level":"ERROR","message":"LOW ERROR: BadRequestError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"BadRequestError","errorCode":1002,"statusCode":400,"severity":"low","path":"/api/products/occasion/invalid-id","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:41.213Z","context":{"occasionId":"invalid-id"},"isOperational":true,"requestId":"req_1763052281211_10","error":{"name":"BadRequestError","message":"Invalid occasion ID: must be a number","stack":"BadRequestError: Invalid occasion ID: must be a number\n    at Module.getProductsByOccasion (/home/manager/Sync/floresya-v1/api/services/productService.js:270:13)\n    at /home/manager/Sync/floresya-v1/api/controllers/productController.js:190:43\n    at /home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:110:21\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at /home/manager/Sync/floresya-v1/node_modules/router/index.js:295:15\n    at param (/home/manager/Sync/floresya-v1/node_modules/router/index.js:600:14)"}},"requestId":"req_1763052281211_10"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.239Z","level":"WARN","message":"Response: 400 (27ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281211_10","statusCode":400,"duration":"27ms","method":"GET","url":"/api/products/occasion/invalid-id"},"requestId":"req_1763052281211_10"}

stderr | tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should return 401 for unauthenticated requests
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.241Z","level":"INFO","message":"PATCH /api/orders/1/status","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281240_7","method":"PATCH","url":"/api/orders/1/status","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281240_7"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should return 401 for unauthenticated requests
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should return 401 for unauthenticated requests
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.250Z","level":"WARN","message":"Response: 403 (7ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281240_7","statusCode":403,"duration":"7ms","method":"PATCH","url":"/api/orders/1/status"},"requestId":"req_1763052281240_7"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should validate status update payload
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.263Z","level":"INFO","message":"PATCH /api/orders/1/status","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281262_8","method":"PATCH","url":"/api/orders/1/status","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281262_8"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should validate status update payload
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should validate status update payload
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.266Z","level":"WARN","message":"Response: 403 (3ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281262_8","statusCode":403,"duration":"3ms","method":"PATCH","url":"/api/orders/1/status"},"requestId":"req_1763052281262_8"}

 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should handle different SKU formats 109ms
   â†’ expected { id: 1 } to deeply equal {}
 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes 48ms
   â†’ expected 404 "Not Found", got 400 "Bad Request"
stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.276Z","level":"INFO","message":"GET /api/orders/non-existent-endpoint","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281275_9","method":"GET","url":"/api/orders/non-existent-endpoint","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281275_9"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:218:7 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.277Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/non-existent-endpoint","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.279Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/non-existent-endpoint","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:41.280Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders/non-existent-endpoint","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:41.279Z","context":{"path":"/non-existent-endpoint","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052281275_9","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitCritical (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:259:41)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at Route.dispatch (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:117:3)\n    at handle (/home/manager/Sync/floresya-v1/node_modules/router/index.js:435:11)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)"}},"requestId":"req_1763052281275_9"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.285Z","level":"WARN","message":"Response: 401 (9ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281275_9","statusCode":401,"duration":"9ms","method":"GET","url":"/api/orders/non-existent-endpoint"},"requestId":"req_1763052281275_9"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle invalid HTTP methods
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.295Z","level":"INFO","message":"PUT /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281295_10","method":"PUT","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281295_10"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle invalid HTTP methods
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle invalid HTTP methods
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.298Z","level":"WARN","message":"Response: 403 (2ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281295_10","statusCode":403,"duration":"2ms","method":"PUT","url":"/api/orders"},"requestId":"req_1763052281295_10"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle missing content-type for POST
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.314Z","level":"INFO","message":"POST /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281314_11","method":"POST","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281314_11"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle missing content-type for POST
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle missing content-type for POST
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.317Z","level":"WARN","message":"Response: 403 (2ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281314_11","statusCode":403,"duration":"2ms","method":"POST","url":"/api/orders"},"requestId":"req_1763052281314_11"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses
[32m[INFO][0m {"timestamp":"2025-11-13T16:44:41.327Z","level":"INFO","message":"GET /api/orders","caller":{"function":"unknown","file":"unknown"},"context":{"requestId":"req_1763052281327_12","method":"GET","url":"/api/orders","ip":"::ffff:127.0.0.1"},"requestId":"req_1763052281327_12"}

 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject malformed JSON 40ms
   â†’ expected 400 "Bad Request", got 500 "Internal Server Error"
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should return 401 for unauthenticated requests 28ms
   â†’ expected 401 "Unauthorized", got 403 "Forbidden"
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should validate status update payload 14ms
   â†’ expected 401 "Unauthorized", got 403 "Forbidden"
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints 19ms
   â†’ expected 404 "Not Found", got 401 "Unauthorized"
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle invalid HTTP methods 14ms
   â†’ expected 404 "Not Found", got 403 "Forbidden"
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle missing content-type for POST 17ms
   â†’ expected [ 400, 401, 415 ] to include 403
stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:35:14[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:265:10[90m)[39m
    at Object.warn [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:495:38[90m)[39m
    at authenticate [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/auth/auth.middleware.js:64:12[90m)[39m
    at Layer.handleRequest [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:152:17[90m)[39m
    at next [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/route.js:157:13[90m)[39m
    at requestMetrics [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/security/rateLimit.js:306:3[90m)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:279:10[90m)[39m
    at Object.error [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:496:46[90m)[39m
    at errorHandler [90m(/home/manager/Sync/floresya-v1/[39mapi/middleware/error/errorHandler.js:72:7[90m)[39m
    at Layer.handleError [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/lib/layer.js:116:17[90m)[39m
    at trimPrefix [90m(/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:340:13[90m)[39m
    at [90m/home/manager/Sync/floresya-v1/[39mnode_modules/[4mrouter[24m/index.js:297:9 {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/error_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.332Z","level":"WARN","message":"Authentication failed: No token provided","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:35:14"},"context":{"path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.333Z","level":"WARN","message":"Authentication failed","caller":{"function":"authenticate","file":"/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:64:12"},"context":{"error":"Authentication required: No token provided","path":"/","method":"GET","ip":"::ffff:127.0.0.1"}}
[31m[ERROR][0m {"timestamp":"2025-11-13T16:44:41.335Z","level":"ERROR","message":"MEDIUM ERROR: UnauthorizedError","caller":{"function":"errorHandler","file":"/home/manager/Sync/floresya-v1/api/middleware/error/errorHandler.js:72:7"},"context":{"errorName":"UnauthorizedError","errorCode":2001,"statusCode":401,"severity":"medium","path":"/api/orders","method":"GET","ip":"::ffff:127.0.0.1","timestamp":"2025-11-13T16:44:41.333Z","context":{"path":"/","hasAuthHeader":false},"isOperational":true,"requestId":"req_1763052281327_12","error":{"name":"UnauthorizedError","message":"Authentication required: No token provided","stack":"UnauthorizedError: Authentication required: No token provided\n    at authenticate (/home/manager/Sync/floresya-v1/api/middleware/auth/auth.middleware.js:40:13)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)\n    at requestMetrics (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:306:3)\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:414:5\n    at /home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:218:7\n    at rateLimitAdmin (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:245:39)\n    at protectAdminOperations (/home/manager/Sync/floresya-v1/api/middleware/security/rateLimit.js:404:3)\n    at Layer.handleRequest (/home/manager/Sync/floresya-v1/node_modules/router/lib/layer.js:152:17)\n    at next (/home/manager/Sync/floresya-v1/node_modules/router/lib/route.js:157:13)"}},"requestId":"req_1763052281327_12"}

stdout | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses
[33m[WARN][0m {"timestamp":"2025-11-13T16:44:41.339Z","level":"WARN","message":"Response: 401 (11ms)","caller":{"function":"ServerResponse.emit (node:events:536:35","file":"at ServerResponse.emit (node:events:536:35)"},"context":{"requestId":"req_1763052281327_12","statusCode":401,"duration":"11ms","method":"GET","url":"/api/orders"},"requestId":"req_1763052281327_12"}

stderr | tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses
Failed to write to log file: Error: EACCES: permission denied, open '/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'
[90m    at Object.writeFileSync (node:fs:2368:20)[39m
[90m    at Object.appendFileSync (node:fs:2449:6)[39m
    at StructuredLogger.writeToFile [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:175:10[90m)[39m
    at StructuredLogger.log [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:244:10[90m)[39m
    at StructuredLogger.logResponse [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:327:10[90m)[39m
    at ServerResponse.<anonymous> [90m(/home/manager/Sync/floresya-v1/[39mapi/utils/logger.js:421:12[90m)[39m
[90m    at ServerResponse.emit (node:events:536:35)[39m
[90m    at onFinish (node:_http_outgoing:1031:10)[39m
[90m    at callback (node:internal/streams/writable:766:21)[39m
[90m    at afterWrite (node:internal/streams/writable:710:5)[39m {
  errno: [33m-13[39m,
  code: [32m'EACCES'[39m,
  syscall: [32m'open'[39m,
  path: [32m'/home/manager/Sync/floresya-v1/logs/warn_2025-11-13.log'[39m
}

stdout | tests/integration/api/orders.integration.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include security headers in responses 20ms
 Ã— tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include CORS headers 7ms
   â†’ expected 200 "OK", got 204 "No Content"
 Ã— tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully 98ms
   â†’ expected 200 "OK", got 400 "Bad Request"
stdout | tests/integration/api/products.integration.test.js
ðŸ§¹ DI Container and mocks cleaned up

 âœ“ tests/integration/api/products.integration.test.js > Products API Integration Tests > Health Check Integration > should respond to health check endpoint 141ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 17 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  tests/functional/comprehensive.test.js [ tests/functional/comprehensive.test.js ]
 FAIL  tests/architecture/architectural-compliance.test.js [ tests/architecture/architectural-compliance.test.js ]
 FAIL  tests/architecture/error-handling-compliance-REFACTORED.test.js [ tests/architecture/error-handling-compliance-REFACTORED.test.js ]
 FAIL  tests/architecture/error-handling-compliance.test.js [ tests/architecture/error-handling-compliance.test.js ]
 FAIL  tests/architecture/soft-delete-compliance.test.js [ tests/architecture/soft-delete-compliance.test.js ]
 FAIL  api/__tests__/unit/product-service-with-di.test.js [ api/__tests__/unit/product-service-with-di.test.js ]
 FAIL  api/__tests__/unit/repository-pattern.test.js [ api/__tests__/unit/repository-pattern.test.js ]
Error: [vitest-worker]: Timeout calling "fetch" with "["/home/manager/Sync/floresya-v1/tests/setup-global.js","web"]"
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/62]âŽ¯

 FAIL  tests/performance/service-performance.test.js [ tests/performance/service-performance.test.js ]
Error: Failed to resolve import "../../../api/repositories/BaseRepository.index.js" from "tests/performance/service-performance.test.js". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/manager/Sync/floresya-v1/tests/performance/service-performance.test.js:29:8
  28 |      it('should handle multiple findById calls efficiently', async () => {
  29 |        const { UnifiedBaseRepository } = await import(
  30 |          '../../../api/repositories/BaseRepository.index.js'
     |          ^
  31 |        )
  32 |  
 â¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:31106:43
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:31103:14
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/config.js:29590:18
 â¯ node_modules/vite/dist/node/chunks/config.js:29648:32
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:29616:4
 â¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:30905:14
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:26043:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/62]âŽ¯

 FAIL  api/__tests__/integration/admin-panel.test.js [ api/__tests__/integration/admin-panel.test.js ]
 FAIL  api/__tests__/integration/general-api.test.js [ api/__tests__/integration/general-api.test.js ]
 FAIL  api/__tests__/integration/product-catalog.test.js [ api/__tests__/integration/product-catalog.test.js ]
 FAIL  api/__tests__/integration/shopping-cart.test.js [ api/__tests__/integration/shopping-cart.test.js ]
Error: Transform failed with 1 error:
/home/manager/Sync/floresya-v1/api/__tests__/integration/setup.js:149:23: ERROR: "mockDatabase" is not declared in this file
  Plugin: vite:client-inject
  File: /home/manager/Sync/floresya-v1/api/__tests__/integration/setup.js
 â¯ failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 â¯ node_modules/esbuild/lib/main.js:736:50
 â¯ responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 â¯ handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 â¯ Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/62]âŽ¯

 FAIL  api/__tests__/unit/product-controller-with-di.test.js [ api/__tests__/unit/product-controller-with-di.test.js ]
Error: [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/62]âŽ¯

 FAIL  api/__tests__/unit/supabase-mocking-demo.test.js [ api/__tests__/unit/supabase-mocking-demo.test.js ]
Error: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock
 â¯ api/services/productService.js:12:1
     10|  */
     11| 
     12| import { DB_SCHEMA } from './supabaseClient.js'
       | ^
     13| import DIContainer from '../architecture/di-container.js'
     14| import {

Caused by: ReferenceError: Cannot access '__vi_import_0__' before initialization
 â¯ api/__tests__/unit/supabase-mocking-demo.test.js:16:24
 â¯ api/services/productService.js:12:1

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/62]âŽ¯

 FAIL  api/controllers/__tests__/productImageController.test.js [ api/controllers/__tests__/productImageController.test.js ]
Error: [vitest-worker]: Timeout calling "fetch" with "["/api/repositories/BaseRepository.js","web"]"
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/62]âŽ¯

 FAIL  api/controllers/__tests__/userController.test.js [ api/controllers/__tests__/userController.test.js ]
Error: [vitest-worker]: Timeout calling "resolveId" with "["fs","/home/manager/Sync/floresya-v1/api/utils/logger.js","web"]"
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/62]âŽ¯

 FAIL  tests/unit/middleware/auth.test.js [ tests/unit/middleware/auth.test.js ]
Error: Failed to resolve import "../../../../api/middleware/auth/auth.middleware.js" from "tests/unit/middleware/auth.test.js". Does the file exist?
  Plugin: vite:import-analysis
  File: /home/manager/Sync/floresya-v1/tests/unit/middleware/auth.test.js:2:0
  32 |    }
  33 |  }))
  34 |  const __vi_import_0__ = await import("../../../../api/middleware/auth/auth.middleware.js");
     |                                       ^
  35 |  const __vi_import_1__ = await import("../../../../api/services/authService.js");
  36 |  const __vi_import_2__ = await import("../../../../api/errors/AppError.js");
 â¯ TransformPluginContext._formatLog node_modules/vite/dist/node/chunks/config.js:31106:43
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/config.js:31103:14
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/config.js:29590:18
 â¯ node_modules/vite/dist/node/chunks/config.js:29648:32
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/config.js:29616:4
 â¯ EnvironmentPluginContainer.transform node_modules/vite/dist/node/chunks/config.js:30905:14
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/config.js:26043:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/62]âŽ¯


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 45 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  tests/architecture/custom-error-compliance.test.js > Custom Error Compliance - AppError & Error Classes > 3. SPECIFIC ERROR CLASSES > Business Logic Errors > should create InsufficientStockError with inventory details
Error: Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/architecture/custom-error-compliance.test.js:284:9
    282| 
    283|     describe('Business Logic Errors', () => {
    284|       it('should create InsufficientStockError with inventory details'â€¦
       |         ^
    285|         const error = new InsufficientStockError(123, 10, 5)
    286| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should accept valid order creation requests
AssertionError: expected [ 200, 201, 400, 401, 500 ] to include 403
 â¯ tests/integration/api/orders.integration.test.js:90:10
     88|         .send(validOrderData)
     89|         .set('Content-Type', 'application/json')
     90|         .expect(response => {
       |          ^
     91|           // Accept various status codes depending on implementation
     92|           expect([200, 201, 400, 401, 500]).toContain(response.status)
 â¯ tests/integration/api/orders.integration.test.js:92:45
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject invalid order data
AssertionError: expected [ 400, 401, 422 ] to include 403
 â¯ tests/integration/api/orders.integration.test.js:107:10
    105|         .send(invalidOrderData)
    106|         .set('Content-Type', 'application/json')
    107|         .expect(response => {
       |          ^
    108|           // Should fail validation
    109|           expect([400, 401, 422]).toContain(response.status)
 â¯ tests/integration/api/orders.integration.test.js:109:35
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > POST /api/orders (Order Creation) > should reject malformed JSON
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/integration/api/orders.integration.test.js:118:10
    116|         .send('invalid json {')
    117|         .set('Content-Type', 'application/json')
    118|         .expect(400)
       |          ^
    119|     })
    120|   })
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should return 401 for unauthenticated requests
Error: expected 401 "Unauthorized", got 403 "Forbidden"
 â¯ tests/integration/api/orders.integration.test.js:127:10
    125|         .patch('/api/orders/1/status')
    126|         .send({ status: 'shipped' })
    127|         .expect(401)
       |          ^
    128| 
    129|       expect(response.body.success).toBe(false)
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > PATCH /api/orders/:id/status (Admin Only) > should validate status update payload
Error: expected 401 "Unauthorized", got 403 "Forbidden"
 â¯ tests/integration/api/orders.integration.test.js:136:10
    134|         .patch('/api/orders/1/status')
    135|         .send({ invalid_field: 'value' })
    136|         .expect(401) // Auth fails first
       |          ^
    137|     })
    138|   })
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should return 404 for non-existent order endpoints
Error: expected 404 "Not Found", got 401 "Unauthorized"
 â¯ tests/integration/api/orders.integration.test.js:142:67
    140|   describe('Error Handling', () => {
    141|     it('should return 404 for non-existent order endpoints', async () â€¦
    142|       await request(app).get('/api/orders/non-existent-endpoint').expeâ€¦
       |                                                                   ^
    143|     })
    144| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle invalid HTTP methods
Error: expected 404 "Not Found", got 403 "Forbidden"
 â¯ tests/integration/api/orders.integration.test.js:148:10
    146|       await request(app)
    147|         .put('/api/orders') // PUT on collection endpoint
    148|         .expect(404)
       |          ^
    149|     })
    150| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Error Handling > should handle missing content-type for POST
AssertionError: expected [ 400, 401, 415 ] to include 403
 â¯ tests/integration/api/orders.integration.test.js:155:10
    153|         .post('/api/orders')
    154|         .send('plain text data')
    155|         .expect(response => {
       |          ^
    156|           expect([400, 401, 415]).toContain(response.status)
    157|         })
 â¯ tests/integration/api/orders.integration.test.js:156:35
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/62]âŽ¯

 FAIL  tests/integration/api/orders.integration.test.js > Orders API Integration Tests > Security Headers > should include CORS headers
Error: expected 200 "OK", got 204 "No Content"
 â¯ tests/integration/api/orders.integration.test.js:172:66
    170| 
    171|     it('should include CORS headers', async () => {
    172|       const response = await request(app).options('/api/orders').expecâ€¦
       |                                                                  ^
    173| 
    174|       expect(response.headers['access-control-allow-origin']).toBeDefiâ€¦
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/carousel > should return carousel products successfully
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/api/products.integration.test.js:54:10
     52|       const response = await request(app)
     53|         .get('/api/products/carousel')
     54|         .expect(200)
       |          ^
     55|         .expect('Content-Type', /json/)
     56| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/with-occasions > should return products with occasions successfully
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/api/products.integration.test.js:69:10
     67|       const response = await request(app)
     68|         .get('/api/products/with-occasions')
     69|         .expect(200)
       |          ^
     70|         .expect('Content-Type', /json/)
     71| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should return products by occasion successfully
Error: expected 200 "OK", got 400 "Bad Request"
 â¯ tests/integration/api/products.integration.test.js:85:10
     83|       const response = await request(app)
     84|         .get(`/api/products/occasion/${occasionId}`)
     85|         .expect(200)
       |          ^
     86|         .expect('Content-Type', /json/)
     87| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/occasion/:occasionId > should handle different occasion IDs
Error: expected 200 "OK", got 400 "Bad Request"
 â¯ tests/integration/api/products.integration.test.js:99:10
     97|       const response = await request(app)
     98|         .get(`/api/products/occasion/${occasionId}`)
     99|         .expect(200)
       |          ^
    100|         .expect('Content-Type', /json/)
    101| 
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should return product by SKU successfully
AssertionError: expected { Object (success, data, ...) } to deeply equal { success: true, data: {}, â€¦(1) }

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "data": {},[39m
[32m-   "message": "Product by SKU retrieved successfully",[39m
[31m+   "data": {[39m
[31m+     "id": 1,[39m
[31m+   },[39m
[31m+   "message": "Product retrieved successfully",[39m
[2m    "success": true,[22m
[2m  }[22m

 â¯ tests/integration/api/products.integration.test.js:115:29
    113|         .expect('Content-Type', /json/)
    114| 
    115|       expect(response.body).toEqual({
       |                             ^
    116|         success: true,
    117|         data: {},

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > GET /api/products/sku/:sku > should handle different SKU formats
AssertionError: expected { id: 1 } to deeply equal {}

[32m- Expected[39m
[31m+ Received[39m

[32m- {}[39m
[31m+ {[39m
[31m+   "id": 1,[39m
[31m+ }[39m

 â¯ tests/integration/api/products.integration.test.js:130:34
    128| 
    129|       expect(response.body.success).toBe(true)
    130|       expect(response.body.data).toEqual({})
       |                                  ^
    131|     })
    132|   })

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should return 404 for non-existent routes
Error: expected 404 "Not Found", got 400 "Bad Request"
 â¯ tests/integration/api/products.integration.test.js:138:10
    136|       await request(app)
    137|         .get('/api/products/non-existent-route')
    138|         .expect(404)
       |          ^
    139|         .expect('Content-Type', /json/)
    140|     })
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/62]âŽ¯

 FAIL  tests/integration/api/products.integration.test.js > Products API Integration Tests > Error Handling > should handle malformed URLs gracefully
Error: expected 200 "OK", got 400 "Bad Request"
 â¯ tests/integration/api/products.integration.test.js:143:67
    141| 
    142|     it('should handle malformed URLs gracefully', async () => {
    143|       await request(app).get('/api/products/occasion/invalid-id').expeâ€¦
       |                                                                   ^
    144|     })
    145|   })
 â¯ Test._assertStatus node_modules/supertest/lib/test.js:309:14
 â¯ node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert node_modules/supertest/lib/test.js:195:23
 â¯ localAssert node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> node_modules/supertest/lib/test.js:152:11

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/62]âŽ¯

 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should return products with default filters
Error: Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/unit/controller/productController.test.js:111:7
    109| 
    110|   describe('getAllProducts()', () => {
    111|     it('should return products with default filters', async () => {
       |       ^
    112|       // Arrange
    113|       getAllProducts.mockResolvedValue([mockProduct])

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/62]âŽ¯

 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by featured when query param is true
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by featured when query param is false
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply search term from query
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should filter by occasion slug
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply sorting by price ascending
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should apply pagination with limit
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should include images when includeImageSize is specified
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getAllProducts() > should return empty array when no products found
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return product by valid ID
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return product with images when specified
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should handle string ID parameter
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should include deactivated products for admin
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > getProductById() > should return 404 when product not found
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should create product with valid data
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should return 400 when validation fails
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > createProduct() > should return 400 when SKU already exists
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should update product with valid data
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should return 404 when product not found
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateProduct() > should return 400 when validation fails
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > deleteProduct() > should deactivate product (soft delete)
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > deleteProduct() > should return 404 when product not found
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should decrement product stock
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should return 400 when quantity is invalid
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateStock() > should return 400 when stock is insufficient
 FAIL  tests/unit/controller/productController.test.js > ProductController - Granular Tests > updateCarouselOrder() > should update carousel order for product
Error: [vitest-worker]: Timeout calling "fetch" with "["/api/controllers/productController.js","web"]"
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/62]âŽ¯

 FAIL  tests/unit/services/ProductService.test.js > ProductService - Framework Tests > getAllProducts() > should return products with default filters
Error: Test timed out in 15000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/unit/services/ProductService.test.js:193:7
    191| 
    192|   describe('getAllProducts()', () => {
    193|     it('should return products with default filters', async () => {
       |       ^
    194|       // Arrange - usando Factory
    195|       mockRepository.findAllWithFilters.mockResolvedValue([mockProductâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/62]âŽ¯

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Errors âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Error âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Error: [vitest-worker]: Timeout calling "resolveSnapshotPath"
 â¯ Object.onTimeoutError node_modules/vitest/dist/chunks/rpc.-pEldfrD.js:53:10
 â¯ Timeout._onTimeout node_modules/vitest/dist/chunks/index.B521nVV-.js:59:62
 â¯ listOnTimeout node:internal/timers:581:17
 â¯ processTimers node:internal/timers:519:7


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Error âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Error: [vitest-worker]: Timeout calling "onTaskUpdate"
 â¯ Object.onTimeoutError node_modules/vitest/dist/chunks/rpc.-pEldfrD.js:53:10
 â¯ Timeout._onTimeout node_modules/vitest/dist/chunks/index.B521nVV-.js:59:62
 â¯ listOnTimeout node:internal/timers:581:17
 â¯ processTimers node:internal/timers:519:7


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Error âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Error: [vitest-worker]: Timeout calling "onTaskUpdate"
 â¯ Object.onTimeoutError node_modules/vitest/dist/chunks/rpc.-pEldfrD.js:53:10
 â¯ Timeout._onTimeout node_modules/vitest/dist/chunks/index.B521nVV-.js:59:62
 â¯ listOnTimeout node:internal/timers:581:17
 â¯ processTimers node:internal/timers:519:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯


 Test Files  22 failed | 7 passed (30)
      Tests  45 failed | 209 passed (289)
     Errors  3 errors
   Start at  13:37:39
   Duration  420.01s (transform 118.14s, setup 188.08s, collect 162.83s, tests 294.61s, environment 277.59s, prepare 238.00s)

